"use strict";(()=>{var e={};e.id=547,e.ids=[547],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},1006:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>N,patchFetch:()=>v,requestAsyncStorage:()=>R,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var t={};s.r(t),s.d(t,{DELETE:()=>y,GET:()=>m,PUT:()=>x});var i=s(9303),o=s(8716),n=s(3131),a=s(7070),p=s(728),u=s(5456),c=s(5630),d=s(9489);let l=c.Ry({title:c.Z_().min(1,"Title is required").optional(),description:c.Z_().min(1,"Description is required").optional(),price:c.Rx().positive("Price must be positive").optional(),type:c.Km(["APARTMENT","HOUSE","CONDO","TOWNHOUSE","STUDIO"]).optional(),status:c.Km(["AVAILABLE","RENTED","SOLD"]).optional(),bedrooms:c.Rx().min(0,"Bedrooms must be 0 or more").optional(),bathrooms:c.Rx().min(0,"Bathrooms must be 0 or more").optional(),area:c.Rx().positive("Area must be positive").optional(),address:c.Z_().min(1,"Address is required").optional(),city:c.Z_().min(1,"City is required").optional(),state:c.Z_().min(1,"State is required").optional(),zipCode:c.Z_().min(1,"Zip code is required").optional(),latitude:c.Rx().optional(),longitude:c.Rx().optional(),images:c.IX(c.Z_()).min(1,"At least one image is required").optional(),amenities:c.IX(c.Z_()).optional()});async function m(e,{params:r}){try{let e=await p._.property.findUnique({where:{id:r.id},include:{owner:{select:{id:!0,name:!0,email:!0,phone:!0,avatar:!0}}}});if(!e)return a.NextResponse.json({success:!1,error:"Property not found"},{status:404});let s={...e,images:JSON.parse(e.images),amenities:e.amenities?JSON.parse(e.amenities):[]};return a.NextResponse.json({success:!0,data:s})}catch(e){return console.error("Get property error:",e),a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function x(e,{params:r}){try{let s=e.cookies.get("token")?.value;if(!s)return a.NextResponse.json({success:!1,error:"Authentication required"},{status:401});let t=(0,u.WX)(s);if(!t)return a.NextResponse.json({success:!1,error:"Invalid token"},{status:401});let i=await p._.property.findUnique({where:{id:r.id}});if(!i)return a.NextResponse.json({success:!1,error:"Property not found"},{status:404});if(i.ownerId!==t.userId)return a.NextResponse.json({success:!1,error:"Unauthorized"},{status:403});let o=await e.json(),n=l.parse(o),c={...n};n.images&&(c.images=JSON.stringify(n.images)),n.amenities&&(c.amenities=JSON.stringify(n.amenities));let d=await p._.property.update({where:{id:r.id},data:c,include:{owner:{select:{id:!0,name:!0,email:!0,phone:!0,avatar:!0}}}}),m={...d,images:JSON.parse(d.images),amenities:d.amenities?JSON.parse(d.amenities):[]};return a.NextResponse.json({success:!0,data:m,message:"Property updated successfully"})}catch(e){if(console.error("Update property error:",e),e instanceof d.j)return a.NextResponse.json({success:!1,error:e.issues[0]?.message||"Validation failed"},{status:400});return a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function y(e,{params:r}){try{let s=e.cookies.get("token")?.value;if(!s)return a.NextResponse.json({success:!1,error:"Authentication required"},{status:401});let t=(0,u.WX)(s);if(!t)return a.NextResponse.json({success:!1,error:"Invalid token"},{status:401});let i=await p._.property.findUnique({where:{id:r.id}});if(!i)return a.NextResponse.json({success:!1,error:"Property not found"},{status:404});if(i.ownerId!==t.userId)return a.NextResponse.json({success:!1,error:"Unauthorized"},{status:403});return await p._.property.delete({where:{id:r.id}}),a.NextResponse.json({success:!0,message:"Property deleted successfully"})}catch(e){return console.error("Delete property error:",e),a.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let f=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/properties/[id]/route",pathname:"/api/properties/[id]",filename:"route",bundlePath:"app/api/properties/[id]/route"},resolvedPagePath:"C:\\Users\\HP\\Downloads\\task_project\\project\\src\\app\\api\\properties\\[id]\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:R,staticGenerationAsyncStorage:h,serverHooks:g}=f,N="/api/properties/[id]/route";function v(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},5456:(e,r,s)=>{s.d(r,{Oe:()=>u,RA:()=>c,WX:()=>d,c_:()=>p});var t=s(1482),i=s.n(t),o=s(2023),n=s.n(o);let a=process.env.JWT_SECRET||"fallback-secret-key",p=async e=>n().hash(e,12),u=async(e,r)=>n().compare(e,r),c=e=>i().sign(e,a,{expiresIn:"7d"}),d=e=>{try{return i().verify(e,a)}catch(e){return null}}},728:(e,r,s)=>{s.d(r,{_:()=>i});let t=require("@prisma/client"),i=globalThis.prisma??new t.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[276,39],()=>s(1006));module.exports=t})();